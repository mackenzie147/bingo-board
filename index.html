<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 Bingo Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
        }
        .bingo-item {
            aspect-ratio: 1 / 1;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .bingo-item.status-inprogress {
            background-color: #FEF9C3; /* yellow-100 */
            border-color: #FDE047; /* yellow-400 */
            transform: scale(1.03);
        }
        .bingo-item.status-completed {
            background-color: #D1FAE5; /* green-100 */
            border-color: #34D399; /* green-400 */
            transform: scale(1.03);
        }
        .bingo-item.status-completed .item-text {
            text-decoration: line-through;
            opacity: 0.7;
        }
        .item-text[contenteditable="true"] {
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">2025 Bingo Board</h1>
            <p id="subheading" class="text-gray-500 mt-2">Add your goals and track your progress!</p>
        </header>

        <div id="auth-loading" class="text-center py-10">
            <p>Connecting to your board...</p>
        </div>
        
        <div id="auth-error" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-6" role="alert">
            <strong class="font-bold">Project Not Configured!</strong>
            <span class="block sm:inline">Please check the browser console for more details. This usually means the Firebase configuration is missing or incorrect in the HTML file.</span>
        </div>

        <main id="app-content" class="hidden">
            <!-- Add Item Form -->
            <div class="mb-6 bg-white p-4 rounded-lg shadow-sm">
                <div class="flex flex-col sm:flex-row gap-3">
                    <input type="text" id="new-item-input" placeholder="Add a new bingo item..." class="flex-grow w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="add-item-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition-colors w-full sm:w-auto">Add Item</button>
                </div>
            </div>

            <!-- Bingo Grid -->
            <div id="bingo-grid" class="bingo-grid">
                <!-- Bingo items will be dynamically inserted here -->
            </div>
        </main>
    </div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, doc, onSnapshot, addDoc, updateDoc, deleteDoc, serverTimestamp, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // -----------------------------------------------------------------------------
        // IMPORTANT:
        // You are seeing this because you ran into a common configuration issue!
        // The application, when running on your local computer or on a fresh deployment,
        // doesn't know where to save your data online. To fix this, we need to connect
        // it to a free "backend" service from Google called Firebase. It's
        // a one-time setup that will give you a special key to paste into the file.
        // -----------------------------------------------------------------------------
        // PASTE YOUR FIREBASE CONFIGURATION HERE
        // -----------------------------------------------------------------------------
        const firebaseConfig = {
          apiKey: "AIzaSyB8q-jT15zfaiiqHDyeoZl_Ccz5tQMTzk4",
          authDomain: "bingo-project-e9e10.firebaseapp.com",
          projectId: "bingo-project-e9e10",
          storageBucket: "bingo-project-e9e10.appspot.com",
          messagingSenderId: "995103961297",
          appId: "1:995103961297:web:e5f07ed199e02bc4ee95f0",
          measurementId: "G-KL097JXKRC"
        };
        // -----------------------------------------------------------------------------
        // END OF FIREBASE CONFIGURATION
        // -----------------------------------------------------------------------------

        // -- App State --
        let db, auth, userId, itemsUnsubscribe;
        const items = new Map();

        // -- DOM Elements --
        const authLoadingEl = document.getElementById('auth-loading');
        const authErrorEl = document.getElementById('auth-error');
        const appContentEl = document.getElementById('app-content');
        const newItemInput = document.getElementById('new-item-input');
        const addItemBtn = document.getElementById('add-item-btn');
        const bingoGrid = document.getElementById('bingo-grid');

        // -- Firebase Initialization --
        function initializeFirebase() {
            try {
                if (!firebaseConfig || !firebaseConfig.apiKey) {
                    throw new Error("Firebase config is missing.");
                }
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                handleAuthentication();
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                showAuthError();
            }
        }

        function handleAuthentication() {
            onAuthStateChanged(auth, user => {
                if (user) {
                    userId = user.uid;
                    authLoadingEl.classList.add('hidden');
                    appContentEl.classList.remove('hidden');
                    listenForItems();
                } else {
                    signInAnonymously(auth).catch(error => {
                        console.error("Anonymous sign-in failed:", error);
                        showAuthError();
                    });
                }
            });
        }
        
        function showAuthError() {
            authLoadingEl.classList.add('hidden');
            authErrorEl.classList.remove('hidden');
        }

        // -- Firestore Functions --
        function listenForItems() {
            if (itemsUnsubscribe) itemsUnsubscribe(); // Unsubscribe from previous listener
            
            const itemsRef = collection(db, 'bingoBoards', '2025', 'items');
            const q = query(itemsRef);

            itemsUnsubscribe = onSnapshot(q, (snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    const docData = change.doc.data();
                    const docId = change.doc.id;

                    if (change.type === "added") {
                        items.set(docId, { id: docId, ...docData });
                        renderNewItem(docId, docData);
                    }
                    if (change.type === "modified") {
                        items.set(docId, { id: docId, ...docData });
                        updateItemInDOM(docId, docData);
                    }
                    if (change.type === "removed") {
                        items.delete(docId);
                        removeItemFromDOM(docId);
                    }
                });
            }, (error) => {
                console.error("Error listening to items:", error);
            });
        }
        
        async function addNewItem() {
            const text = newItemInput.value.trim();
            if (text === '') return;
            
            try {
                const itemsRef = collection(db, 'bingoBoards', '2025', 'items');
                await addDoc(itemsRef, {
                    text: text,
                    status: 'normal', // normal, inprogress, completed
                    createdAt: serverTimestamp()
                });
                newItemInput.value = '';
            } catch (error) {
                console.error("Error adding document: ", error);
            }
        }

        async function updateItem(id, data) {
            try {
                const itemRef = doc(db, 'bingoBoards', '2025', 'items', id);
                await updateDoc(itemRef, data);
            } catch (error) {
                console.error("Error updating item:", error);
            }
        }
        
        async function deleteItem(id) {
             try {
                const itemRef = doc(db, 'bingoBoards', '2025', 'items', id);
                await deleteDoc(itemRef);
            } catch (error) {
                console.error("Error deleting item:", error);
            }
        }


        // -- DOM Manipulation --
        function renderNewItem(id, data) {
            const itemEl = document.createElement('div');
            itemEl.id = `item-${id}`;
            itemEl.className = 'bingo-item flex items-center justify-center p-3 border-2 border-gray-300 bg-white rounded-lg shadow-sm text-center';
            
            const textEl = document.createElement('p');
            textEl.className = 'item-text text-sm font-medium';
            textEl.textContent = data.text;
            
            itemEl.appendChild(textEl);
            bingoGrid.appendChild(itemEl);
            
            updateItemInDOM(id, data);
        }
        
        function updateItemInDOM(id, data) {
            const itemEl = document.getElementById(`item-${id}`);
            if (!itemEl) return;
            
            itemEl.className = 'bingo-item flex items-center justify-center p-3 border-2 border-gray-300 bg-white rounded-lg shadow-sm text-center'; // Reset classes
            if (data.status === 'inprogress') {
                itemEl.classList.add('status-inprogress');
            } else if (data.status === 'completed') {
                itemEl.classList.add('status-completed');
            }
            
            const textEl = itemEl.querySelector('.item-text');
            if (textEl && textEl.textContent !== data.text) {
                 textEl.textContent = data.text;
            }
        }
        
        function removeItemFromDOM(id) {
            const itemEl = document.getElementById(`item-${id}`);
            if (itemEl) {
                itemEl.remove();
            }
        }
        
        // -- Event Listeners --
        addItemBtn.addEventListener('click', addNewItem);
        newItemInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                addNewItem();
            }
        });

        bingoGrid.addEventListener('click', (e) => {
            const itemEl = e.target.closest('.bingo-item');
            if (!itemEl) return;

            // Prevent status change if text is being edited
            if (itemEl.querySelector('.item-text[contenteditable="true"]')) return;

            const id = itemEl.id.replace('item-', '');
            const currentItem = items.get(id);
            if (!currentItem) return;
            
            let newStatus;
            if (currentItem.status === 'normal') newStatus = 'inprogress';
            else if (currentItem.status === 'inprogress') newStatus = 'completed';
            else newStatus = 'normal';
            
            updateItem(id, { status: newStatus });
        });

        bingoGrid.addEventListener('dblclick', (e) => {
            const textEl = e.target.closest('.item-text');
            if (!textEl) return;
            
            const itemEl = textEl.closest('.bingo-item');
            const id = itemEl.id.replace('item-', '');
            
            textEl.setAttribute('contenteditable', 'true');
            textEl.focus();
            
            // Select all text
            const selection = window.getSelection();
            const range = document.createRange();
            range.selectNodeContents(textEl);
            selection.removeAllRanges();
            selection.addRange(range);

            const onBlur = () => {
                textEl.setAttribute('contenteditable', 'false');
                const newText = textEl.textContent.trim();
                
                if (newText === '') {
                    deleteItem(id);
                } else {
                    const currentItem = items.get(id);
                    if (currentItem && currentItem.text !== newText) {
                         updateItem(id, { text: newText });
                    }
                }
                textEl.removeEventListener('blur', onBlur);
                textEl.removeEventListener('keydown', onKeydown);
            };
            
            const onKeydown = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    textEl.blur();
                } else if (e.key === 'Escape') {
                    const currentItem = items.get(id);
                    textEl.textContent = currentItem ? currentItem.text : '';
                    textEl.blur();
                }
            };

            textEl.addEventListener('blur', onBlur);
            textEl.addEventListener('keydown', onKeydown);
        });

        // -- App Start --
        document.addEventListener('DOMContentLoaded', initializeFirebase);
    </script>
</body>
</html>

